on: [push, pull_request]

name: CI

jobs:

  test_qmake:
    name: build and run tests with qmake
    runs-on: ubuntu-18.04
    env:
      DEBIAN_FRONTEND: noninteractive
    steps:
      - uses: actions/checkout@v1
      - name: Install qt and build tools
        run: |
          sudo apt-get update &&
          sudo apt-get install -y --no-install-recommends \
            pkg-config g++ make \
            qt5-default qttools5-dev-tools
      - name: Run qmake
        run: mkdir build && cd build && qmake -r .. "QMAKE_CXXFLAGS=-Werror"
      - name: Build
        run: cd build && make -j8
      - name: Run tests
        run: build/tests/fontobene-qt5-tests

  test_cmake:
    name: build and run tests with cmake 3.16 (ubuntu 20.04)
    runs-on: ubuntu-20.04
    env:
      DEBIAN_FRONTEND: noninteractive
    steps:
      - uses: actions/checkout@v1
      - name: Install qt and build tools
        run: |
          sudo apt-get update &&
          sudo apt-get install -y --no-install-recommends \
            pkg-config g++ make cmake \
            qt5-default qttools5-dev-tools
      - name: Run cmake
        run: cmake -S . -B build
      - name: Build
        run: cmake --build build -j8 -v
      - name: Run tests
        run: build/tests/fontobene-qt5-tests

  test_cmake_min_version:
    name: build and run tests with cmake 3.5 (ubuntu 16.04)
    runs-on: ubuntu-16.04
    env:
      DEBIAN_FRONTEND: noninteractive
    steps:
      - uses: actions/checkout@v1
      - name: Install qt and build tools
        run: |
          sudo apt-get update &&
          sudo apt-get install -y --no-install-recommends \
            pkg-config g++ make cmake \
            qt5-default qttools5-dev-tools
      - name: Run cmake
        run: cmake -S . -B build
      - name: Build
        run: cmake --build build -j8 -v
      - name: Run tests
        run: build/tests/fontobene-qt5-tests
